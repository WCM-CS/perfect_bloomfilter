INNER_LINES=()
OUTER_LINES=()
INNER_TOTAL=0
OUTER_TOTAL=0

for file in ./data/pbf_data/*; do
  if [[ -f "$file" ]]; then
    filename=$(basename "$file")
    lines=$(wc -l < "$file")
    if [[ "$filename" == inner* ]]; then
      INNER_LINES+=("$lines")
      INNER_TOTAL=$((INNER_TOTAL + lines))
    elif [[ "$filename" == outer* ]]; then
      OUTER_LINES+=("$lines")
      OUTER_TOTAL=$((OUTER_TOTAL + lines))
    fi
  fi
done

stats() {
  arr=("$@")
  min=${arr[0]}
  max=${arr[0]}
  sum=0
  for n in "${arr[@]}"; do
    (( n < min )) && min=$n
    (( n > max )) && max=$n
    sum=$((sum + n))
  done
  len=${#arr[@]}
  avg=$(echo "scale=2; $sum / $len" | bc)
  echo "count=$len min=$min max=$max avg=$avg"
}

echo "Inner files: $(stats "${INNER_LINES[@]}") total_lines=$INNER_TOTAL"
echo "Outer files: $(stats "${OUTER_LINES[@]}") total_lines=$OUTER_TOTAL"
